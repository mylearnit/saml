from saml2.client import Saml2Client
from saml2.config import Config as Saml2Config
from saml2 import (
    BINDING_HTTP_POST,
    BINDING_HTTP_REDIRECT,
    entity,
)
from django.conf import settings


def _get_saml_client():
    saml_settings = {
        'entityid': 'https://saml.isminspire.com/saml3/metadata/',
        'metadata': {
            'local': [settings.BASE_DIR / 'auth0_com-metadata.xml'],
        },
        'service': {
            'sp': {
                'endpoints': {
                    'assertion_consumer_service': [
                        ('https://saml.isminspire.com/saml3/acs/', BINDING_HTTP_REDIRECT),
                        ('https://saml.isminspire.com/saml3/acs/', BINDING_HTTP_POST)
                    ],
                },
                'allow_unsolicited': True,
                'authn_requests_signed': False,
                'logout_requests_signed': True,
                'want_assertions_signed': True,
                'want_response_signed': False,
            },
        },
    }

    # if 'ENTITY_ID' in settings.SAML2_AUTH:
    #     saml_settings['entityid'] = settings.SAML2_AUTH['ENTITY_ID']

    # if 'NAME_ID_FORMAT' in settings.SAML2_AUTH:
    #     saml_settings['service']['sp']['name_id_format'] = settings.SAML2_AUTH['NAME_ID_FORMAT']

    spConfig = Saml2Config()
    spConfig.load(saml_settings)
    spConfig.allow_unknown_attributes = True
    saml_client = Saml2Client(config=spConfig)
    return saml_client

def a():
    resp='''PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIElEPSJfZjEyMDlmYWYwYjIyNDc4ZDQyN2MiICBJblJlc3BvbnNlVG89ImlkLXM0dEpXSnh1cFE2QUpodUxXIiAgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjQtMDMtMjhUMDk6MDI6MDMuODMxWiIgIERlc3RpbmF0aW9uPSJodHRwczovL3NhbWwuaXNtaW5zcGlyZS5jb20vc2FtbDMvYWNzLyI+PHNhbWw6SXNzdWVyIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPnVybjpkZXYtN2R5Mnp5cXZlc3JmMGhxbS51cy5hdXRoMC5jb208L3NhbWw6SXNzdWVyPjxzYW1scDpTdGF0dXM+PHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPjwvc2FtbHA6U3RhdHVzPjxzYW1sOkFzc2VydGlvbiB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiBWZXJzaW9uPSIyLjAiIElEPSJfUGFhWjg3YU8xOGYyM1V6eFFwa3QyNkt2MWNRY3YyVmsiIElzc3VlSW5zdGFudD0iMjAyNC0wMy0yOFQwOTowMjowMy44MjVaIj48c2FtbDpJc3N1ZXI+dXJuOmRldi03ZHkyenlxdmVzcmYwaHFtLnVzLmF1dGgwLmNvbTwvc2FtbDpJc3N1ZXI+PFNpZ25hdHVyZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PFNpZ25lZEluZm8+PENhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PFJlZmVyZW5jZSBVUkk9IiNfUGFhWjg3YU8xOGYyM1V6eFFwa3QyNkt2MWNRY3YyVmsiPjxUcmFuc2Zvcm1zPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48L1RyYW5zZm9ybXM+PERpZ2VzdE1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNzaGExIi8+PERpZ2VzdFZhbHVlPlJVeWJkYmp1aDRHR1ZyUlMwQ1dqR3poTFN2WT08L0RpZ2VzdFZhbHVlPjwvUmVmZXJlbmNlPjwvU2lnbmVkSW5mbz48U2lnbmF0dXJlVmFsdWU+ZnlZSUdKa2dYY2tzUHVZWjE5VHFTSm9IZlJ5N3I3OWNGT0dJelpWbDRNTVNOSjZlZ05OZlpSQzR1TzZhRnFyeHFrNVBmNlB5VWt6MU0yR1htTUJNY2hUalltSXZHZVVPQ3c5Q2VodjExanovOWRldUlMSWQ5WE9TSTRZdG5iM2hPZWJ4UUdSZVhlSDkydGx1RWNWV1ZyOHZrVUc3NGp0dTV4L3pydEVDMW9PaHJlTXlMRjZGbFM4dnoxaU5LblYvZjgrTmdVbGJMeEQvWUFySktqOXVkNkhGdUpCQWU0ZDllSGI4b0JHdUhOaXdoYmU3aVNYeFk4dGJiRHpmNDBOTkptVlh4REFtTlFEYjhScHl0UmtqSmp0NDh1ZXFpOHI1ZnFnMHlzbm83NVNDWWtrcEZIcjJmbVZJYkdFamJJVXF0VEQ5NjUwMW5heWxxRHYxZXd6VjdRPT08L1NpZ25hdHVyZVZhbHVlPjxLZXlJbmZvPjxYNTA5RGF0YT48WDUwOUNlcnRpZmljYXRlPk1JSURIVENDQWdXZ0F3SUJBZ0lKVFlGQndMVUNtYWlLTUEwR0NTcUdTSWIzRFFFQkN3VUFNQ3d4S2pBb0JnTlZCQU1USVdSbGRpMDNaSGt5ZW5seGRtVnpjbVl3YUhGdExuVnpMbUYxZEdnd0xtTnZiVEFlRncweU5EQXpNamN4TVRVek16VmFGdzB6TnpFeU1EUXhNVFV6TXpWYU1Dd3hLakFvQmdOVkJBTVRJV1JsZGkwM1pIa3llbmx4ZG1WemNtWXdhSEZ0TG5WekxtRjFkR2d3TG1OdmJUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUlNcm1tRW9HZmVSVEtCUnRqczdBT05QTGFwaEQ2dzRFejB6czJPT2hPM0VJZUtOaFE5d2VoaW9EYXZ5K1B6RUpUbi95WVdMelVkVU5Ebkt4aE4xUUdsdjRLRUlkRkNjK1pEaGNtazFFdmp0V3VwakZqVE1nV1NFV052cjZ6OUZSRmFBYjZmdG5INHVpUjhMbVhad3JLcjdtRExHSEUrcVdYZS9hNUJCZ3ZjN3NsaTFKL3ZwalNhTEpyY1NBTHNsQjk3MURTd3Z5SVVkRjZ0UkZpbUlUMWR0T29xcXFtRUE4cEwrWmJJY3lSRkNmNHFQMHJtOE95YXFFZ0NvN28xeUZ2V2VvYWNuM3dKWXJjOTFORHpEanlmbjNiTVhIOVNKNkVxSmhhV00rTHVVOEIzbjA5Q0dHQkFvOTRkcmxFRS94aWppMVlDT1hST0lmRDhqRXNzRG1UMENBd0VBQWFOQ01FQXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVVFaHhjdUJUcjRSa2g4RnVEZmx4cFNjRXVmdGd3RGdZRFZSMFBBUUgvQkFRREFnS0VNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFvMDNzVUMxcUNaTkRZUTNsOHJ3bEVieU9TUUo2b2J4VndDWnVnWGZZQXFBNDRpb0VTZVJQN2YvLzQzS1Q4bkthU0E2ZVA2L1lidTNTUUhxdUNNYjZ5aXNGWjZISVdsczdXQVo1UkkyQ0I5djFsQll1Y2taeTREQ2hmbHdBK0tHV210WSt6dkxZUlBtU05FN0JtMmI0M0ZON2liOUkxSkFDMldHTDVqb1JLZWhnaG1WdzhhdnB1Q2lFUGEwQzBZWHloQjdEbVV0UjVwM1FtTXlVSHhwcEx4MjlUVDg3Vk9XS1BqdWJYZGtwdDR2c00vK2pzU2pPWGJud3RVQzI4TDdya2hMSWswTnNQbmZmdGJsaDc4dGRXd204SjM1UU0yU082VkpIRndraVg0STZsbmFBVFlESkRCR1NzQXF4TlRWa1NQellLY1NUZzdhUDY4dFdnNnJOTDwvWDUwOUNlcnRpZmljYXRlPjwvWDUwOURhdGE+PC9LZXlJbmZvPjwvU2lnbmF0dXJlPjxzYW1sOlN1YmplY3Q+PHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6MS4xOm5hbWVpZC1mb3JtYXQ6dW5zcGVjaWZpZWQiPmF1dGgwfDY2MDQwYjcxMzAxZTNlZDQ5ZDEwYjg2ODwvc2FtbDpOYW1lSUQ+PHNhbWw6U3ViamVjdENvbmZpcm1hdGlvbiBNZXRob2Q9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpjbTpiZWFyZXIiPjxzYW1sOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAyNC0wMy0yOFQxMDowMjowMy44MjVaIiBSZWNpcGllbnQ9Imh0dHBzOi8vc2FtbC5pc21pbnNwaXJlLmNvbS9zYW1sMy9hY3MvIiBJblJlc3BvbnNlVG89ImlkLXM0dEpXSnh1cFE2QUpodUxXIi8+PC9zYW1sOlN1YmplY3RDb25maXJtYXRpb24+PC9zYW1sOlN1YmplY3Q+PHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMjQtMDMtMjhUMDk6MDI6MDMuODI1WiIgTm90T25PckFmdGVyPSIyMDI0LTAzLTI4VDEwOjAyOjAzLjgyNVoiLz48c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMjQtMDMtMjhUMDk6MDI6MDMuODI1WiIgU2Vzc2lvbkluZGV4PSJfMklPU1R0M2J6Vll1bGVnbTIyaWlyS0lJd0NEOU9xR3kiPjxzYW1sOkF1dGhuQ29udGV4dD48c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3Nlczp1bnNwZWNpZmllZDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWw6QXV0aG5Db250ZXh0Pjwvc2FtbDpBdXRoblN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIj48c2FtbDpBdHRyaWJ1dGUgTmFtZT0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvbmFtZWlkZW50aWZpZXIiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5hdXRoMHw2NjA0MGI3MTMwMWUzZWQ0OWQxMGI4Njg8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvZW1haWxhZGRyZXNzIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+c3VoYWlsQHBpeGR5bmFtaWNzLmNvbTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy91cG4iIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5zdWhhaWxAcGl4ZHluYW1pY3MuY29tPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLmF1dGgwLmNvbS9pZGVudGl0aWVzL2RlZmF1bHQvY29ubmVjdGlvbiIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPlVzZXJuYW1lLVBhc3N3b3JkLUF1dGhlbnRpY2F0aW9uPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLmF1dGgwLmNvbS9pZGVudGl0aWVzL2RlZmF1bHQvcHJvdmlkZXIiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5hdXRoMDwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vc2NoZW1hcy5hdXRoMC5jb20vaWRlbnRpdGllcy9kZWZhdWx0L2lzU29jaWFsIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOmJvb2xlYW4iPmZhbHNlPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLmF1dGgwLmNvbS9jbGllbnRJRCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPjdKV2tVTzRDSnBFdWZSSzBmRXF3QmZwdzhhRExQVU1wPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLmF1dGgwLmNvbS9jcmVhdGVkX2F0IiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+MjAyNC0wMy0yN1QxMjowNTowNS40MjRaPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLmF1dGgwLmNvbS9lbWFpbF92ZXJpZmllZCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpib29sZWFuIj5mYWxzZTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vc2NoZW1hcy5hdXRoMC5jb20vbmFtZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPnN1aGFpbEBwaXhkeW5hbWljcy5jb208L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgTmFtZT0iaHR0cDovL3NjaGVtYXMuYXV0aDAuY29tL25pY2tuYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+c3VoYWlsPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLmF1dGgwLmNvbS9waWN0dXJlIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVyaSI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+aHR0cHM6Ly9zLmdyYXZhdGFyLmNvbS9hdmF0YXIvOGU1MWVhYjE0M2E1YTQ5Yzc4MzdmZDNhNTNhMDBlNzE/cz00ODAmYW1wO3I9cGcmYW1wO2Q9aHR0cHMlM0ElMkYlMkZjZG4uYXV0aDAuY29tJTJGYXZhdGFycyUyRnN1LnBuZzwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vc2NoZW1hcy5hdXRoMC5jb20vdXBkYXRlZF9hdCIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1cmkiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPjIwMjQtMDMtMjhUMDk6MDI6MDMuMjMzWjwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjwvc2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sOkFzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPg=='''


    saml_client = _get_saml_client()

    authn_response = saml_client.parse_authn_request_response(resp, entity.BINDING_HTTP_POST)
    user_identity = authn_response.get_identity()
    print(user_identity)